<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mongo="http://www.springframework.org/schema/data/mongo"
	xsi:schemaLocation="http://www.springframework.org/schema/beans   
          http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
          http://www.springframework.org/schema/context   
          http://www.springframework.org/schema/context/spring-context-3.0.xsd  
          http://www.springframework.org/schema/data/mongo
          http://www.springframework.org/schema/data/mongo/spring-mongo.xsd">

	<!-- 加载mongodb的属性配置文件 
	<context:property-placeholder order="1" location="classpath:config/mongodb.properties" ignore-unresolvable="true" />
	-->
	<!-- 加载memcached的属性配置文件 -->
	<context:property-placeholder order="2" location="classpath:memcached.properties" ignore-unresolvable="true" />


	<!-- 定义mongo对象，对应的是mongodb官方jar包中的Mongo，replica-set设置集群副本的ip地址和端口 
		connections-per-host	每个主机答应的连接数（每个主机的连接池大小），当连接池被用光时，会被阻塞住 ，默以为10 
		threads-allowed-to-block-for-connection-multiplier	可等待线程倍数，默认为5.例如connectionsPerHost最大允许10个连接，则10*5=50个线程可以等待，更多的线程将直接抛异常 
		connect-timeout			连接超时时间(毫秒)，默认为10000 max-wait-time 线程等待连接可用的最大时间(毫秒)，默认为120000 
		auto-connect-retry		服务器是否自动重连，默认为false 
		socket-keep-alive 		是socket连接在防火墙上保持活动的特性，默认为false 
		socket-timeout			socket读写时超时时间(毫秒)，默认为0，不超时 
		slave-ok				指明是否答应驱动从次要节点或者奴隶节点读取数据，默以为false 
		write-number 
		write-timeout 
		write-fsync 
		
	<mongo:mongo id="mongo" replica-set="${mongo.hostport}">
		<mongo:options connections-per-host="${mongo.connectionsPerHost}"
			threads-allowed-to-block-for-connection-multiplier="${mongo.threadsAllowedToBlockForConnectionMultiplier}"
			connect-timeout="${mongo.connectTimeout}" max-wait-time="${mongo.maxWaitTime}"
			auto-connect-retry="${mongo.autoConnectRetry}" socket-keep-alive="${mongo.socketKeepAlive}"
			socket-timeout="${mongo.socketTimeout}" slave-ok="${mongo.slaveOk}"
			write-number="1" write-timeout="0" write-fsync="true" />
	</mongo:mongo>

	<bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
		<constructor-arg ref="mongo" />
		<constructor-arg name="databaseName" value="offer_mongo" />
	</bean>		
		-->

	<!-- <mongo:db-factory dbname="database" mongo-ref="mongo" /> -->

	<!-- Memcahed配置 -->
	<bean id="memcachedClient" class="net.spy.memcached.spring.MemcachedClientFactoryBean">
		<!-- 包括由空格或逗号分隔的主机或IP地址与端口号 -->
		<property name="servers" value="${memcahed.addr}" />
		<property name="protocol" value="BINARY" />
		<!-- 设置默认的转码器(默认以net.spy.memcached.transcoders.SerializingTranscoder) -->
		<property name="transcoder">
			<bean class="net.spy.memcached.transcoders.SerializingTranscoder">
				<!-- 启用了压缩，增加或减小需压缩的包的大小限制 -->
				<property name="compressionThreshold" value="1024" />
			</bean>
		</property>
		
		<!-- 以毫秒为单位设置默认的操作超时时间 -->
		<property name="opTimeout" value="3000" />
		<!-- 设置超时次数上限是1998 -->
		<property name="timeoutExceptionThreshold" value="1998" />
		<!-- 设置哈希算法(见net.spy.memcached.HashAlgorithm的值) -->
		<property name="hashAlg">
			<value type="net.spy.memcached.DefaultHashAlgorithm">KETAMA_HASH</value>
		</property>
		<!-- 设置定位器类型(ARRAY_MOD,CONSISTENT),默认是ARRAY_MOD -->
		<property name="locatorType" value="CONSISTENT" />
		<!-- 故障模式(取消，重新分配，重试)，默认是重新分配 -->
		<property name="failureMode" value="Redistribute" />
		<!-- 是否使用Nagle算法，设置为true -->
		<property name="useNagleAlgorithm" value="false" />
	</bean>

	<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
		<!-- 设置上传文件的最大尺寸为10MB -->
		<property name="maxUploadSize">
			<value>10000000</value>
		</property>
	</bean>

</beans>